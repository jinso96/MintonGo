<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MintonGo</title>
<style>
  .calendar {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 5px;
    width: 200px;
  }
  .calendar-day {
    width: 60px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 10px;
    border: 1px solid #ccc;
    text-align: center;
    cursor: pointer;
  }
  .selected {
    background-color: lightblue;
  }
  .attendance-list {
    margin-top: 10px;
  }
  .attendance-list p {
    margin: 5px 0;
  }
  .input-section {
    margin-top: 20px;
  }
</style>
</head>
<body>

<h1>MintonGo</h1>

<div class="calendar" id="calendar">
  <!-- Days will be dynamically added here -->
</div>

<div class="input-section">
  <input type="text" id="nameInput" placeholder="Enter your name">
  <button onclick="Check()">Check</button>
</div>

<h2>Who is coming?</h2>
<div class="attendance-list" id="attendanceList">
  <!-- Attendance list will be dynamically updated here -->
</div>

<script>
  const people = ['은영', '언주', '소영', '아영', '선애', '제희', '현희', '소정'];
  const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sun'];
  let attendance = JSON.parse(localStorage.getItem('attendance')) || {};
  let selectedDays = [];
  let selectedPerson = null;

  function toggleDay(day) {
    const index = selectedDays.indexOf(day);
    if (index === -1) {
      selectedDays.push(day);
    } else {
      selectedDays.splice(index, 1);
    }
    updateCalendar();
  }

  function Check() {
    const input = document.getElementById('nameInput').value.trim();
    if (input.endsWith('초기화')) {
      const person = input.replace('초기화', '').trim();
      if (people.includes(person)) {
        clearAttendanceForPerson(person);
        saveAttendance();
        updateAttendanceList();
        alert(`${person}의 참석 정보가 초기화되었습니다.`);
      } else {
        alert('초기화할 유효한 이름을 입력하세요.');
      }
      return;
    }

    if (!people.includes(input)) {
      alert('유효한 이름을 입력하세요.');
      return;
    }

    selectedPerson = input;
    clearAttendanceForPerson(selectedPerson);
    selectedDays.forEach(day => {
      toggleAttendance(day, selectedPerson);
    });
    saveAttendance();
    updateCalendar();
  }

  function clearAttendanceForPerson(person) {
    days.forEach(day => {
      if (attendance[day]) {
        const index = attendance[day].indexOf(person);
        if (index !== -1) {
          attendance[day].splice(index, 1);
        }
      }
    });
  }

  function toggleAttendance(day, person) {
    if (!attendance[day]) {
      attendance[day] = [];
    }
    const index = attendance[day].indexOf(person);
    if (index === -1) {
      attendance[day].push(person);
    } else {
      attendance[day].splice(index, 1);
    }
    updateAttendanceList();
  }

  function updateAttendanceList() {
    const attendanceList = document.getElementById('attendanceList');
    attendanceList.innerHTML = '';

    days.forEach(day => {
      const dayAttendance = document.createElement('p');
      const peopleAttending = attendance[day] ? attendance[day] : [];
      dayAttendance.textContent = `${day}: ${peopleAttending.join(', ') || 'None'} (${peopleAttending.length} attending)`;
      dayAttendance.addEventListener('click', () => editAttendance(day));
      attendanceList.appendChild(dayAttendance);
    });
  }

  function editAttendance(day) {
    const person = prompt(`Edit attendance for ${day}. Enter name to toggle attendance:`);
    if (person && people.includes(person)) {
      toggleAttendance(day, person);
      saveAttendance();
    } else {
      alert('Invalid name.');
    }
  }

  function updateCalendar() {
    document.querySelectorAll('.calendar-day').forEach(day => day.classList.remove('selected'));
    selectedDays.forEach(day => {
      document.getElementById(day.toLowerCase()).classList.add('selected');
    });
  }

  function createCalendar() {
    const calendar = document.getElementById('calendar');
    days.forEach(day => {
      const calendarDay = document.createElement('div');
      calendarDay.classList.add('calendar-day');
      calendarDay.textContent = day;
      calendarDay.id = day.toLowerCase();
      calendarDay.addEventListener('click', () => toggleDay(day));
      calendar.appendChild(calendarDay);
    });
    days.forEach(day => {
      if (!attendance[day]) {
        attendance[day] = [];
      }
    });
    updateAttendanceList(); // Ensure the attendance list is displayed by default
  }

  function saveAttendance() {
    localStorage.setItem('attendance', JSON.stringify(attendance));
  }

  function checkAndClearAttendance() {
    const now = new Date();
    const lastClearTime = localStorage.getItem('lastClearTime');
    const oneWeek = 7 * 24 * 60 * 60 * 1000; // One week in milliseconds

    if (!lastClearTime || (now - new Date(lastClearTime)) >= oneWeek) {
      if (now.getDay() === 0 && now.getHours() === 0) {
        attendance = {};
        saveAttendance();
        localStorage.setItem('lastClearTime', now.toISOString());
        updateAttendanceList();
      }
    }
  }

  createCalendar();
  checkAndClearAttendance();
  setInterval(checkAndClearAttendance, 60 * 1000); // Check every minute

</script>

</body>
</html>
